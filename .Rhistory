merged_data <- read.csv(merged_file_path)
# Step 2: Filter dataset for relevant predictors and remove rows with NA values
filtered_data <- merged_data %>%
filter(!is.na(bulk_density_g_cm3) & !is.na(Ca_meq_100g) & !is.na(ph) &
!is.na(percent_clay) & !is.na(specific_conductance_us_cm) & !is.na(carbon_weight_perc))
# Step 3: Separate data by transect location
upland_data <- filtered_data %>% filter(transect_location == "upland")
transition_data <- filtered_data %>% filter(transect_location == "transition")
wetland_data <- filtered_data %>% filter(transect_location == "wetland")
# Define predictors (using your selected predictors only)
predictors <- c("bulk_density_g_cm3", "Ca_meq_100g", "ph", "percent_clay", "specific_conductance_us_cm")
# Correlation matrix check to identify multicollinearity
correlation_matrix <- filtered_data %>%
select(all_of(predictors)) %>%
cor(use = "pairwise.complete.obs")
print("Correlation Matrix:")
print(correlation_matrix)
# Function to build regression model and calculate metrics
build_model <- function(data, transect_name) {
# Standardize numeric predictors
standardized_data <- data %>%
mutate(across(all_of(predictors), ~ scale(.), .names = "std_{col}"))
# Build regression model
formula <- as.formula(paste("carbon_weight_perc ~", paste(names(standardized_data)[grepl("^std_", names(standardized_data))], collapse = "+")))
model <- lm(formula, data = standardized_data)
# Extract R²
model_r2 <- summary(model)$r.squared
# Extract F-statistic and p-value from the model summary
f_statistic <- summary(model)$fstatistic  # Extract F-test results
f_value <- f_statistic[1]  # F-statistic value
f_df1 <- f_statistic[2]    # Degrees of freedom numerator
f_df2 <- f_statistic[3]    # Degrees of freedom denominator
f_p_value <- pf(f_value, f_df1, f_df2, lower.tail = FALSE)  # Calculate p-value for the F-test
# Try VIF calculation; handle error gracefully if aliased coefficients are present
vif_values <- tryCatch({
car::vif(model)
}, error = function(e) {
warning("VIF calculation failed due to aliased coefficients.")
return(rep(NA, length(predictors)))
})
# Extract coefficients and tidy them
model_summary <- summary(model)$coefficients %>%
as.data.frame() %>%
rownames_to_column(var = "Predictor") %>%
rename(Estimate = Estimate, Std.Error = `Std. Error`,
t.value = `t value`, P.Value = `Pr(>|t|)`) %>%
filter(Predictor != "(Intercept)") %>%
mutate(Std.Beta = abs(Estimate))  # Calculate standardized beta coefficients
# Combine VIF values into the summary
model_summary <- model_summary %>%
mutate(VIF = ifelse(Predictor %in% names(vif_values), vif_values[Predictor], NA),
R2 = model_r2, F_value = f_value, F_p_value = f_p_value, Transect = transect_name)
return(model_summary)
}
# Build models for upland, transition, and wetland
upland_summary <- build_model(upland_data, "Upland")
transition_summary <- build_model(transition_data, "Transition")
wetland_summary <- tryCatch(build_model(wetland_data, "Wetland"), error = function(e) NULL)
# Combine summaries for analysis
combined_summary <- bind_rows(upland_summary, transition_summary, if (!is.null(wetland_summary)) wetland_summary else NULL)
# Print summaries
print("\n--- Upland Model Summary ---")
print(upland_summary)
print("\n--- Transition Model Summary ---")
print(transition_summary)
if (!is.null(wetland_summary)) {
print("\n--- Wetland Model Summary ---")
print(wetland_summary)
} else {
cat("\nWetland model failed to build.\n")
}
# Visualization of standardized beta coefficients
ggplot(data = combined_summary, aes(x = Std.Beta, y = reorder(Predictor, Std.Beta), fill = Transect)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Standardized Beta Coefficients Across Transects",
x = "Standardized Beta Coefficients (Std.Beta)",
y = "Predictors",
fill = "Transect Location") +
theme_minimal(base_size = 20) +
theme(
axis.title = element_text(size = 24, face = "bold"),
axis.title.y = element_text(size = 24, face = "bold"),
axis.text = element_text(size = 18),
axis.text.y = element_text(size = 18),
plot.title = element_text(size = 28, face = "bold", hjust = 0.5),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 16)
)
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Visualization: R² and p-value of F statistic
library(ggplot2)
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
print(combined_plot)
# Visualization: R² and p-value of F statistic
library(ggplot2)
# Set order for Transect levels: Wetland -> Transition -> Upland
combined_summary$Transect <- factor(combined_summary$Transect, levels = c("Wetland", "Transition", "Upland"))
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
print(combined_plot)
# Load necessary libraries
library(tidyverse)   # For data manipulation
library(ggplot2)     # For visualization
library(patchwork)   # For combining plots
# Step 1: Create a dataframe with R² and F-test p-values
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Step 2: Reorder Transect levels to Wetland > Transition > Upland
model_metrics$Transect <- factor(model_metrics$Transect, levels = c("Wetland", "Transition", "Upland"))
# Step 3: Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Step 4: Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Step 5: Show plots side by side
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
# Print the combined plot
print(combined_plot)
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Step 2: Reorder Transect levels to Wetland > Transition > Upland
model_metrics$Transect <- factor(model_metrics$Transect, levels = c("Wetland", "Transition", "Upland"))
# Visualization: R² and p-value of F statistic
library(ggplot2)
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
print(combined_plot)
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Visualization: R² and p-value of F statistic
library(ggplot2)
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
print(combined_plot)
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Wetland", "Transition", "Upland"),  # Adjust order here directly
R2 = c(0.9090167, 0.8101306, 0.6022602),
F_p_value = c(0.004446007, 0.000120636, 1.590391e-05)
)
# Visualization: R² and p-value of F statistic
library(ggplot2)
# Define a colorblind-friendly palette
colorblind_palette <- c("Wetland" = "#377eb8", "Transition" = "#4daf4a", "Upland" = "#984ea3")  # Okabe-Ito palette example
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
scale_fill_manual(values = colorblind_palette) +  # Apply the colorblind-friendly palette
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
scale_fill_manual(values = colorblind_palette) +  # Apply the colorblind-friendly palette
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
# Print the combined plot
print(combined_plot)
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Adjust order of Transect levels: Wetland → Transition → Upland
model_metrics$Transect <- factor(model_metrics$Transect, levels = c("Wetland", "Transition", "Upland"))
# Load necessary libraries
library(ggplot2)
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
# Print the combined plot
print(combined_plot)
# Load necessary libraries
library(tidyverse)   # For data manipulation
library(car)         # For calculating VIFs
library(broom)       # For tidying regression outputs
library(ggplot2)     # For visualization
library(patchwork)   # For combining plots
# Step 1: Read the dataset
merged_file_path <- "/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/aug 2025 update to v3/ec1_soil_v3/merged.csv"
merged_data <- read.csv(merged_file_path)
# Step 2: Filter dataset for relevant predictors and remove rows with NA values
filtered_data <- merged_data %>%
filter(!is.na(bulk_density_g_cm3) & !is.na(Ca_meq_100g) & !is.na(ph) &
!is.na(percent_clay) & !is.na(specific_conductance_us_cm) & !is.na(carbon_weight_perc))
# Step 3: Separate data by transect location
upland_data <- filtered_data %>% filter(transect_location == "upland")
transition_data <- filtered_data %>% filter(transect_location == "transition")
wetland_data <- filtered_data %>% filter(transect_location == "wetland")
# Define predictors (using your selected predictors only)
predictors <- c("bulk_density_g_cm3", "Ca_meq_100g", "ph", "percent_clay", "specific_conductance_us_cm")
# Correlation matrix check to identify multicollinearity
correlation_matrix <- filtered_data %>%
select(all_of(predictors)) %>%
cor(use = "pairwise.complete.obs")
# Create a data frame with only the relevant R² and p-values for visualization
model_metrics <- data.frame(
Transect = c("Upland", "Transition", "Wetland"),
R2 = c(0.6022602, 0.8101306, 0.9090167),
F_p_value = c(1.590391e-05, 0.000120636, 0.004446007)
)
# Adjust order of Transect levels: Wetland → Transition → Upland
model_metrics$Transect <- factor(model_metrics$Transect, levels = c("Wetland", "Transition", "Upland"))
# Load necessary libraries
library(ggplot2)
# Define a colorblind-friendly palette for the transects
colorblind_palette <- c("Wetland" = "#377eb8", "Transition" = "#4daf4a", "Upland" = "#984ea3")  # Okabe-Ito palette
# Create a bar plot for R² values across transects
r2_plot <- ggplot(model_metrics, aes(x = Transect, y = R2, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
scale_fill_manual(values = colorblind_palette) +  # Apply colorblind-friendly palette
labs(title = "R² Across Transect Locations",
x = "Transect Location",
y = "R²",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Create a bar plot for p-values of F statistic across transects
f_pvalue_plot <- ggplot(model_metrics, aes(x = Transect, y = F_p_value, fill = Transect)) +
geom_bar(stat = "identity", width = 0.6) +
scale_fill_manual(values = colorblind_palette) +  # Apply colorblind-friendly palette
labs(title = "F-Test p-values Across Transect Locations",
x = "Transect Location",
y = "p-value of F Statistic",
fill = "Transect Location") +
theme_minimal(base_size = 15) +
theme(
axis.title.x = element_text(size = 18, face = "bold"),
axis.title.y = element_text(size = 18, face = "bold"),
axis.text.x = element_text(size = 14),
axis.text.y = element_text(size = 14),
plot.title = element_text(size = 20, face = "bold", hjust = 0.5),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
# Show plots side by side
library(patchwork)
combined_plot <- r2_plot + f_pvalue_plot +
plot_annotation(title = "R² and F-Test p-value Metrics Across Transects") +
plot_layout(ncol = 2)
# Print the combined plot
print(combined_plot)
