## Long-format for plotting ---------------------------------------------------
plot_dat <- soil_dat %>%
select(region, transect_location, all_of(cont_vars)) %>%
pivot_longer(
cols = all_of(cont_vars),
names_to = "variable",
values_to = "value"
) %>%
# Drop NAs per variable
filter(!is.na(value)) %>%
# Drop any weird transect locations that slipped in
filter(transect_location %in% c("upland", "transition", "wetland", "water")) %>%
droplevels()
## A general violin plotting function ----------------------------------------
plot_violin_region_transect <- function(df, var_name) {
df_var <- df %>% filter(variable == var_name)
if (nrow(df_var) == 0) {
warning(glue::glue("No non-NA data for variable `{var_name}`; skipping."))
return(NULL)
}
ggplot(df_var, aes(x = transect_location, y = value, fill = region)) +
geom_violin(
alpha = 0.6,
color = "gray30",
trim  = FALSE
) +
# Optional: add median point for each group
stat_summary(
fun = median,
geom = "point",
position = position_dodge(width = 0.9),
size = 1.5,
color = "black"
) +
facet_wrap(~ region, scales = "free_y") +
labs(
x = "Transect position",
y = var_name,
title = paste("Distribution of", var_name, "by region and transect location")
) +
theme_bw() +
theme(
legend.position = "none",
axis.text.x = element_text(angle = 30, hjust = 1)
)
}
## Example: make a single plot for one variable -------------------------------
# Replace "bulk_density_g_cm3" with any name in `cont_vars`
p_bd <- plot_violin_region_transect(plot_dat, "bulk_density_g_cm3")
print(p_bd)
## Batch-generate supplementary figures for many variables --------------------
# Choose a subset of cont_vars you actually care about, or just use cont_vars directly.
vars_to_plot <- cont_vars
# Directory to save figs
out_dir <- "figures/supplementary_region_transect"
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
for (v in vars_to_plot) {
p <- plot_violin_region_transect(plot_dat, v)
if (!is.null(p)) {
ggsave(
filename = file.path(out_dir, paste0("violin_", v, ".png")),
plot     = p,
width    = 7,
height   = 5,
dpi      = 300
)
}
}
get(wd)
mean(is.na(dat$root_presence))
library(tidyverse)
# read data
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
# quick check of column names if needed
# names(dat)
# filter to non-NA carbon + root_presence, and to soil positions if you want
tc_root <- dat %>%
filter(
!is.na(carbon_weight_perc),
!is.na(root_presence),
transect_location %in% c("upland", "transition", "wetland")  # drop sediment/water
) %>%
mutate(
transect_location = factor(
tolower(transect_location),
levels = c("upland", "transition", "wetland")
),
root_presence = factor(root_presence, levels = c("none", "few", "moderate", "many"))
)
# plot: TC by root_presence, faceted by transect_location
ggplot(tc_root, aes(x = root_presence, y = carbon_weight_perc)) +
geom_violin(fill = "grey80", color = "grey30") +
stat_summary(fun = median, geom = "point", size = 1.5, color = "black") +
facet_wrap(~ transect_location) +
labs(
x = "Root presence",
y = "Total C (%)",
title = "Total carbon vs root presence by transect location"
) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
library(tidyverse)
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
tc_root <- dat %>%
filter(
!is.na(carbon_weight_perc),
!is.na(root_presence),
transect_location %in% c("upland", "transition", "wetland")  # optional
) %>%
mutate(
root_presence = factor(root_presence, levels = c("none", "few", "moderate", "many"))
)
ggplot(tc_root, aes(x = root_presence, y = carbon_weight_perc)) +
geom_violin(fill = "grey80", color = "grey30") +
stat_summary(fun = median, geom = "point", size = 1.5, color = "black") +
facet_wrap(~ region) +
labs(
x = "Root presence",
y = "Total C (%)",
title = "Total carbon vs root presence by region"
) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
library(tidyverse)
library(broom)   # for tidy model outputs
library(emmeans) # for pairwise comparisons (optional)
library(emmeans) # for pairwise comparisons (optional)
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
# Prepare data: filter NAs, keep soil positions, order root_presence
tc_root <- dat %>%
filter(
!is.na(carbon_weight_perc),
!is.na(root_presence),
transect_location %in% c("upland", "transition", "wetland")
) %>%
mutate(
root_presence = factor(root_presence,
levels = c("none", "few", "moderate", "many"))
)
# Quick check of counts per category
tc_root %>%
count(root_presence)
mod_aov <- aov(carbon_weight_perc ~ root_presence, data = tc_root)
# ANOVA table
summary(mod_aov)
emm <- emmeans(mod_aov, specs = "root_presence")
# Estimated marginal means
emm
# Pairwise contrasts with Tukey adjustment
pairs(emm, adjust = "tukey")
install.packages("emmeans")
library(emmeans) # for pairwise comparisons (optional)
emm <- emmeans(mod_aov, specs = "root_presence")
# Estimated marginal means
emm
# Pairwise contrasts with Tukey adjustment
pairs(emm, adjust = "tukey")
e
plot(emm)
ggplot(tc_root, aes(x = root_presence, y = carbon_weight_perc)) +
geom_violin(fill = "grey85", color = "grey30") +
stat_summary(fun = median, geom = "point", size = 1.5, color = "black") +
labs(
x = "Root presence",
y = "Total C (%)",
title = "Total carbon vs root presence (all regions, all transect locations)"
) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1))
## Load packages --------------------------------------------------------------
library(tidyverse)
library(broom)    # for tidy model outputs (not strictly needed here, but handy)
library(emmeans)  # for estimated marginal means and pairwise comparisons
## Read data ------------------------------------------------------------------
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
## Prepare data: keep relevant rows and order factor levels -------------------
tc_root <- dat %>%
filter(
!is.na(carbon_weight_perc),   # keep only rows with TC
!is.na(root_presence),        # and with root_presence recorded
transect_location %in% c("upland", "transition", "wetland")  # exclude water/sediment
) %>%
mutate(
root_presence = factor(
root_presence,
levels = c("none", "few", "moderate", "many")  # impose an ordered gradient
)
)
## Quick data check: counts per root_presence category ------------------------
tc_root %>%
count(root_presence)
## One-way ANOVA: total C as a function of root_presence ----------------------
mod_aov <- aov(carbon_weight_perc ~ root_presence, data = tc_root)
## One-way ANOVA: total C as a function of root_presence ----------------------
mod_aov <- aov(carbon_weight_perc ~ root_presence, data = tc_root)
# Standard ANOVA table
summary(mod_aov)
## Estimated marginal means and pairwise contrasts ----------------------------
# Model-based means (Â± SE, CI) for each root_presence class
emm <- emmeans(mod_aov, specs = "root_presence")
emm
# Tukey-adjusted pairwise comparisons among root_presence levels
pairs(emm, adjust = "tukey")
# Quick diagnostic plot of emmeans with confidence intervals
plot(emm)
## Visualization: TC distributions by root presence ---------------------------
ggplot(tc_root, aes(x = root_presence, y = carbon_weight_perc)) +
geom_violin(fill = "grey85", color = "grey30") +       # distribution per category
stat_summary(fun = median, geom = "point",             # add median point
size = 1.5, color = "black") +
labs(
x = "Root presence",
y = "Total C (%)",
title = "Total carbon vs root presence (all regions, all transect locations)"
) +
theme_bw() +
theme(
axis.text.x = element_text(angle = 30, hjust = 1)    # tilt labels for readability
)
tc_root %>%
group_by(root_presence) %>%
summarise(
n = n(),
mean_TC = mean(carbon_weight_perc),
sd_TC   = sd(carbon_weight_perc)
)
par(mfrow = c(1, 2))
plot(mod_aov, which = 1)  # residuals vs fitted
plot(mod_aov, which = 2)  # normal Q-Q
par(mfrow = c(1, 1))
kruskal.test(carbon_weight_perc ~ root_presence, data = tc_root)
tc_root <- dat %>%
filter(
!is.na(carbon_weight_perc),
!is.na(root_presence),
!is.na(region),
!is.na(transect_location),
transect_location %in% c("upland", "transition", "wetland")
) %>%
mutate(
root_presence = factor(root_presence,
levels = c("none", "few", "moderate", "many")),
transect_location = factor(
tolower(transect_location),
levels = c("upland", "transition", "wetland")
),
region = factor(region)
)
mod_region <- lm(
carbon_weight_perc ~ root_presence * region,
data = tc_root
)
anova(mod_region)   # Type I ANOVA table
summary(mod_region)
### what about by transect location
mod_transect <- lm(
carbon_weight_perc ~ root_presence * transect_location,
data = tc_root
)
anova(mod_transect)
mod_full <- lm(
carbon_weight_perc ~ root_presence * region * transect_location,
data = tc_root
)
anova(mod_full)
setwd(/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory)
setwd("/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory")
## Load packages --------------------------------------------------------------
library(tidyverse)
## Read data ------------------------------------------------------------------
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
setwd("/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory")
## Basic cleaning / filtering -------------------------------------------------
# Standardize transect_location to lower case (if needed)
dat <- dat %>%
mutate(
transect_location = tolower(transect_location),
transect_location = factor(
transect_location,
levels = c("upland", "transition", "wetland", "water", "sediment")
)
)
# Keep only rows with region + transect_location and exclude sediment
soil_dat <- dat %>%
filter(
!is.na(region),
!is.na(transect_location),
transect_location != "sediment"
)
# Identify all numeric columns
numeric_vars <- soil_dat %>%
select(where(is.numeric)) %>%
names()
# Columns to EXCLUDE from plotting even if numeric
exclude_vars <- c(
"latitude", "longitude", "elevation_m",
"n", "alpha", "th_r", "th_s",
"water_dissolved_o2_mg_l", "water_orp_mv", "water_ph",
"upland_soil_temperature_degC", "transition_soil_temperature_degC",
"wetland_soil_temperature_degC", "upland_soil_moisture",
"transition_soil_moisture", "wetland_soil_moisture",
"air_temperature_degC", "barometric_pressure_inhg",
"water_color_forel.ule_scale", "volume_ml"
)
cont_vars <- setdiff(numeric_vars, exclude_vars)
## Long-format for plotting ---------------------------------------------------
plot_dat <- soil_dat %>%
select(region, transect_location, all_of(cont_vars)) %>%
pivot_longer(
cols = all_of(cont_vars),
names_to = "variable",
values_to = "value"
) %>%
# Drop NAs per variable
filter(!is.na(value)) %>%
# Drop any weird transect locations that slipped in
filter(transect_location %in% c("upland", "transition", "wetland", "water")) %>%
droplevels()
## A general violin plotting function ----------------------------------------
plot_violin_region_transect <- function(df, var_name) {
df_var <- df %>% filter(variable == var_name)
if (nrow(df_var) == 0) {
warning(glue::glue("No non-NA data for variable `{var_name}`; skipping."))
return(NULL)
}
ggplot(df_var, aes(x = transect_location, y = value, fill = region)) +
geom_violin(
alpha = 0.6,
color = "gray30",
trim  = FALSE
) +
# Optional: add median point for each group
stat_summary(
fun = median,
geom = "point",
position = position_dodge(width = 0.9),
size = 1.5,
color = "black"
) +
facet_wrap(~ region, scales = "free_y") +
labs(
x = "Transect position",
y = var_name,
title = paste("Distribution of", var_name, "by region and transect location")
) +
theme_bw() +
theme(
legend.position = "none",
axis.text.x = element_text(angle = 30, hjust = 1)
)
}
## Example: make a single plot for one variable -------------------------------
# Replace "bulk_density_g_cm3" with any name in `cont_vars`
p_bd <- plot_violin_region_transect(plot_dat, "bulk_density_g_cm3")
print(p_bd)
## Batch-generate supplementary figures for many variables --------------------
# Choose a subset of cont_vars you actually care about, or just use cont_vars directly.
vars_to_plot <- cont_vars
# Directory to save figs
out_dir <- "/supplementary_region_transect"
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
for (v in vars_to_plot) {
p <- plot_violin_region_transect(plot_dat, v)
if (!is.null(p)) {
ggsave(
filename = file.path(out_dir, paste0("violin_", v, ".png")),
plot     = p,
width    = 7,
height   = 5,
dpi      = 300
)
}
}
# Directory to save figs
out_dir <- "/violins"
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
for (v in vars_to_plot) {
p <- plot_violin_region_transect(plot_dat, v)
if (!is.null(p)) {
ggsave(
filename = file.path(out_dir, paste0("violin_", v, ".png")),
plot     = p,
width    = 7,
height   = 5,
dpi      = 300
)
}
}
# Directory to save figs
out_dir <- ""~/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory/violins""
# Directory to save figs
out_dir <- "~/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory/violins""
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
for (v in vars_to_plot) {
p <- plot_violin_region_transect(plot_dat, v)
if (!is.null(p)) {
ggsave(
filename = file.path(out_dir, paste0("violin_", v, ".png")),
# Directory to save figs
out_dir <- "~/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/results/figures/exploratory/violins"
dir.create(out_dir, showWarnings = FALSE, recursive = TRUE)
for (v in vars_to_plot) {
p <- plot_violin_region_transect(plot_dat, v)
if (!is.null(p)) {
ggsave(
filename = file.path(out_dir, paste0("violin_", v, ".png")),
plot     = p,
width    = 7,
height   = 5,
dpi      = 300
)
}
}
## Load packages --------------------------------------------------------------
library(tidyverse)
## Read data ------------------------------------------------------------------
dat <- read_csv(
"/Users/malh455/Library/CloudStorage/OneDrive-PNNL/Documents/projects/compass/ec1_soils/ec1_modex_paper/data/processed/merged.csv"
)
## Basic cleaning / filtering -------------------------------------------------
# Standardize transect_location to lower case (if needed)
dat <- dat %>%
mutate(
transect_location = tolower(transect_location),
transect_location = factor(
transect_location,
levels = c("upland", "transition", "wetland", "water", "sediment")
)
)
# Keep only rows with region + transect_location and exclude sediment
soil_dat <- dat %>%
filter(
!is.na(region),
!is.na(transect_location),
transect_location != "sediment"
)
# Identify all numeric columns
numeric_vars <- soil_dat %>%
select(where(is.numeric)) %>%
names()
# Columns to EXCLUDE from plotting even if numeric
exclude_vars <- c(
"latitude", "longitude", "elevation_m",
"n", "alpha", "th_r", "th_s",
"water_dissolved_o2_mg_l", "water_orp_mv", "water_ph",
"upland_soil_temperature_degC", "transition_soil_temperature_degC",
"wetland_soil_temperature_degC", "upland_soil_moisture",
"transition_soil_moisture", "wetland_soil_moisture",
"air_temperature_degC", "barometric_pressure_inhg",
"water_color_forel.ule_scale", "volume_ml"
)
cont_vars <- setdiff(numeric_vars, exclude_vars)
## Long-format for plotting ---------------------------------------------------
plot_dat <- soil_dat %>%
select(region, transect_location, all_of(cont_vars)) %>%
pivot_longer(
cols = all_of(cont_vars),
names_to = "variable",
values_to = "value"
) %>%
# Drop NAs per variable
filter(!is.na(value)) %>%
# Drop any weird transect locations that slipped in
filter(transect_location %in% c("upland", "transition", "wetland", "water")) %>%
droplevels()
## A general violin plotting function ----------------------------------------
plot_violin_region_transect <- function(df, var_name) {
df_var <- df %>% filter(variable == var_name)
if (nrow(df_var) == 0) {
warning(glue::glue("No non-NA data for variable `{var_name}`; skipping."))
return(NULL)
}
ggplot(df_var, aes(x = transect_location, y = value, fill = region)) +
geom_violin(
alpha = 0.6,
color = "gray30",
trim  = FALSE
) +
# Optional: add median point for each group
stat_summary(
fun = median,
geom = "point",
position = position_dodge(width = 0.9),
size = 1.5,
color = "black"
) +
facet_wrap(~ region, scales = "free_y") +
labs(
x = "Transect position",
y = var_name,
title = paste("Distribution of", var_name, "by region and transect location")
) +
theme_bw() +
theme(
legend.position = "none",
axis.text.x = element_text(angle = 30, hjust = 1)
)
}
## Example: make a single plot for one variable -------------------------------
# Replace "bulk_density_g_cm3" with any name in `cont_vars`
p_bd <- plot_violin_region_transect(plot_dat, "bulk_density_g_cm3")
print(p_bd)
